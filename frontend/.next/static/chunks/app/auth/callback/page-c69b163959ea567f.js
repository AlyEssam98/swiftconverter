(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[453],{2134:(e,t,r)=>{Promise.resolve().then(r.bind(r,2883))},2883:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var s=r(7437),a=r(2265),n=r(3274),i=r(6463),l=r(3429);function o(){let e=(0,i.useRouter)(),t=(0,i.useSearchParams)(),{login:r}=(0,l.a)(),[o,c]=(0,a.useState)(""),u=(0,a.useRef)(!1);return((0,a.useEffect)(()=>{if(u.current)return;let s=t.get("token");if(t.get("error")){u.current=!0,c("OAuth2 authentication failed. Please try again or use email/password login."),setTimeout(()=>e.push("/auth/login"),3e3);return}if(s){u.current=!0;try{r(s),setTimeout(()=>e.push("/dashboard"),100)}catch(t){c("Failed to process login. Please try again."),setTimeout(()=>e.push("/auth/login"),3e3)}}else t.toString()&&(u.current=!0,c("No authentication token received. Please try again."),setTimeout(()=>e.push("/auth/login"),3e3))},[t,r,e]),o)?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-8",children:(0,s.jsx)("div",{className:"w-full max-w-sm space-y-6 text-center",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Authentication Error"}),(0,s.jsx)("p",{className:"text-red-600 mt-4",children:o}),(0,s.jsx)("p",{className:"text-gray-500 text-sm mt-2",children:"Redirecting to login page..."})]})})}):(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-8",children:(0,s.jsx)("div",{className:"w-full max-w-sm space-y-6 text-center",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Processing Login"}),(0,s.jsx)("div",{className:"flex justify-center mt-6",children:(0,s.jsx)(n.Z,{className:"w-8 h-8 animate-spin text-blue-600"})}),(0,s.jsx)("p",{className:"text-gray-500 mt-6",children:"Completing your authentication..."})]})})})}function c(){return(0,s.jsx)(a.Suspense,{fallback:(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-8",children:(0,s.jsx)("div",{className:"w-full max-w-sm space-y-6 text-center",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Processing Login"}),(0,s.jsx)("div",{className:"flex justify-center mt-6",children:(0,s.jsx)(n.Z,{className:"w-8 h-8 animate-spin text-blue-600"})}),(0,s.jsx)("p",{className:"text-gray-500 mt-6",children:"Completing your authentication..."})]})})}),children:(0,s.jsx)(o,{})})}},3429:(e,t,r)=>{"use strict";r.d(t,{AuthProvider:()=>c,a:()=>u});var s=r(7437),a=r(2265),n=r(6264),i=r(6463);let l=(0,a.createContext)(void 0),o="session_token";function c(e){let{children:t}=e,[r,c]=(0,a.useState)(null),[u,d]=(0,a.useState)(!0),h=(0,i.useRouter)(),m=(0,a.useCallback)(()=>{try{sessionStorage.removeItem(o),localStorage.removeItem("token")}catch(e){}c(null)},[]),f=(0,a.useCallback)(async()=>{try{let e=await n.default.get("/api/v1/profile");c(t=>t?{...t,...e.data}:{token:"",...e.data})}catch(e){console.error("Failed to fetch profile",e)}},[]),g=(0,a.useCallback)(async()=>{await f()},[f]);(0,a.useEffect)(()=>{(async()=>{let e=sessionStorage.getItem(o);if(e){c({token:e});try{await f()}catch(e){console.error("Failed to fetch profile during init",e)}}d(!1)})()},[]);let x=async()=>{try{await n.default.post("/api/v1/auth/logout")}catch(e){}m(),h.push("/auth/login")};return(0,s.jsx)(l.Provider,{value:{user:r,login:e=>{sessionStorage.setItem(o,e),c({token:e}),d(!1)},logout:x,isLoading:u,refreshUser:g},children:t})}function u(){let e=(0,a.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},6264:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var s,a=r(8472),n=r(357);let i="session_token",l=a.Z.create({baseURL:null!==(s=n.env.NEXT_PUBLIC_API_URL)&&void 0!==s?s:"http://localhost:8081",headers:{"Content-Type":"application/json"}});l.interceptors.request.use(e=>{let t=sessionStorage.getItem(i);return t&&(e.headers.Authorization="Bearer ".concat(t)),e}),l.interceptors.response.use(e=>e,e=>{var t,r;let s=null===(t=e.response)||void 0===t?void 0:t.status,a=(null===(r=e.config)||void 0===r?void 0:r.url)||"",n=a.includes("/profile")||a.includes("/dashboard")||a.includes("/credits/balance")||a.includes("/conversions");if(401===s&&n){try{sessionStorage.removeItem(i),localStorage.removeItem("token")}catch(e){}return window.location.href="/auth/login",Promise.resolve()}return Promise.reject(e)});let o=l},8030:(e,t,r)=>{"use strict";r.d(t,{Z:()=>o});var s=r(2265);let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),n=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,s.forwardRef)((e,t)=>{let{color:r="currentColor",size:a=24,strokeWidth:l=2,absoluteStrokeWidth:o,className:c="",children:u,iconNode:d,...h}=e;return(0,s.createElement)("svg",{ref:t,...i,width:a,height:a,stroke:r,strokeWidth:o?24*Number(l)/Number(a):l,className:n("lucide",c),...h},[...d.map(e=>{let[t,r]=e;return(0,s.createElement)(t,r)}),...Array.isArray(u)?u:[u]])}),o=(e,t)=>{let r=(0,s.forwardRef)((r,i)=>{let{className:o,...c}=r;return(0,s.createElement)(l,{ref:i,iconNode:t,className:n("lucide-".concat(a(e)),o),...c})});return r.displayName="".concat(e),r}},3274:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(8030).Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},6463:(e,t,r)=>{"use strict";var s=r(1169);r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(t,{useSearchParams:function(){return s.useSearchParams}})}},e=>{var t=t=>e(e.s=t);e.O(0,[472,130,215,744],()=>t(2134)),_N_E=e.O()}]);